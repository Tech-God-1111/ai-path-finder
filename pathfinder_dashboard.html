<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Pathfinder Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: #0f0c29;
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .navbar {
            background: rgba(0, 0, 0, 0.4);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .card {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .stat-card {
            text-align: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            margin: 10px 0;
        }
        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: #00dbde;
        }
        .stat-label {
            font-size: 14px;
            color: #aaa;
            text-transform: uppercase;
        }
        .btn-primary {
            background: #00dbde;
            border: none;
        }
        .btn-primary:hover {
            background: #0093e9;
        }
        .algorithm-card {
            cursor: pointer;
            transition: all 0.3s;
        }
        .algorithm-card:hover {
            background: rgba(0, 219, 222, 0.1);
        }
        .algorithm-card.active {
            background: rgba(0, 219, 222, 0.2);
            border-color: #00dbde;
        }
        .path-grid {
            display: inline-grid;
            gap: 2px;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .grid-cell {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            border-radius: 2px;
        }
        .cell-empty {
            background: rgba(255, 255, 255, 0.1);
        }
        .cell-obstacle {
            background: rgba(255, 50, 50, 0.7);
        }
        .cell-start {
            background: rgba(0, 255, 0, 0.7);
        }
        .cell-end {
            background: rgba(255, 0, 0, 0.7);
        }
        .cell-path {
            background: rgba(0, 219, 222, 0.7);
        }
        .path-list {
            max-height: 200px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            padding: 10px;
        }
        .path-step {
            padding: 5px;
            margin: 2px 0;
            background: rgba(0, 219, 222, 0.1);
            border-radius: 3px;
            font-family: monospace;
        }
        .path-header {
            background: rgba(0, 219, 222, 0.2);
            padding: 8px;
            border-radius: 5px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="fas fa-robot me-2"></i>
                AI Pathfinder Dashboard
            </a>
            <div class="d-flex">
                <button class="btn btn-outline-light btn-sm" onclick="location.href='/'">
                    <i class="fas fa-camera me-1"></i> Live View
                </button>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <div class="row">
            <!-- Left Column -->
            <div class="col-lg-3">
                <!-- System Control -->
                <div class="card p-3">
                    <h5><i class="fas fa-cogs me-2"></i>System Control</h5>
                    <div class="row mt-3">
                        <div class="col-6">
                            <button class="btn btn-success w-100 mb-2" onclick="startSystem()">
                                <i class="fas fa-play"></i> Start
                            </button>
                        </div>
                        <div class="col-6">
                            <button class="btn btn-danger w-100 mb-2" onclick="stopSystem()">
                                <i class="fas fa-stop"></i> Stop
                            </button>
                        </div>
                    </div>
                    <button class="btn btn-warning w-100 mb-2" onclick="autoPoints()">
                        <i class="fas fa-bolt"></i> Auto Points
                    </button>
                    <button class="btn btn-info w-100" onclick="resetMetrics()">
                        <i class="fas fa-redo"></i> Reset Metrics
                    </button>
                </div>

                <!-- Algorithm Selection -->
                <div class="card p-3">
                    <h5><i class="fas fa-brain me-2"></i>Algorithm</h5>
                    <div id="algorithmList" class="mt-3">
                        <!-- Algorithms loaded dynamically -->
                    </div>
                </div>

                <!-- Grid Settings -->
                <div class="card p-3">
                    <h5><i class="fas fa-th me-2"></i>Grid Settings</h5>
                    <div class="mb-3">
                        <label class="form-label">Grid Size: <span id="gridValue">20</span></label>
                        <input type="range" class="form-range" min="10" max="40" step="5"
                               value="20" id="gridSlider" oninput="updateGrid(this.value)">
                    </div>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="autoDetect" checked>
                        <label class="form-check-label" for="autoDetect">Auto-detect points</label>
                    </div>
                </div>
            </div>

            <!-- Middle Column -->
            <div class="col-lg-6">
                <!-- Path Visualization -->
                <div class="card p-3">
                    <h5><i class="fas fa-route me-2"></i>Path Visualization</h5>
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <div class="path-header">
                                <h6>Grid Map with Path</h6>
                                <small>Current: <span id="gridSizeDisplay">20x20</span></small>
                            </div>
                            <div id="pathGridContainer" class="text-center">
                                <!-- Path grid will be rendered here -->
                                <p class="text-muted">Loading path visualization...</p>
                            </div>
                            <div class="mt-3">
                                <div class="d-flex justify-content-around">
                                    <div class="d-flex align-items-center">
                                        <div class="grid-cell cell-start me-2"></div>
                                        <small>Start</small>
                                    </div>
                                    <div class="d-flex align-items-center">
                                        <div class="grid-cell cell-end me-2"></div>
                                        <small>End</small>
                                    </div>
                                    <div class="d-flex align-items-center">
                                        <div class="grid-cell cell-path me-2"></div>
                                        <small>Path</small>
                                    </div>
                                    <div class="d-flex align-items-center">
                                        <div class="grid-cell cell-obstacle me-2"></div>
                                        <small>Obstacle</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="path-header">
                                <h6>Path Details</h6>
                                <small>Steps: <span id="pathSteps">0</span></small>
                            </div>
                            <div id="pathCoordinates" class="path-list">
                                <!-- Path coordinates will be displayed here -->
                                <p class="text-muted">No path data available</p>
                            </div>
                            <div class="mt-3">
                                <div class="d-flex justify-content-between mb-2">
                                    <span>Start Point:</span>
                                    <span id="startPointDisplay" class="badge bg-success">N/A</span>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span>End Point:</span>
                                    <span id="endPointDisplay" class="badge bg-danger">N/A</span>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span>Path Status:</span>
                                    <span id="pathStatus" class="badge bg-warning">No Path</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Performance Stats -->
                <div class="card p-3">
                    <h5><i class="fas fa-chart-line me-2"></i>Performance</h5>
                    <div class="row mt-3">
                        <div class="col-6 col-md-3">
                            <div class="stat-card">
                                <div class="stat-value" id="statFPS">0</div>
                                <div class="stat-label">FPS</div>
                            </div>
                        </div>
                        <div class="col-6 col-md-3">
                            <div class="stat-card">
                                <div class="stat-value" id="statPath">0</div>
                                <div class="stat-label">Path Length</div>
                            </div>
                        </div>
                        <div class="col-6 col-md-3">
                            <div class="stat-card">
                                <div class="stat-value" id="statNodes">0</div>
                                <div class="stat-label">Nodes</div>
                            </div>
                        </div>
                        <div class="col-6 col-md-3">
                            <div class="stat-card">
                                <div class="stat-value" id="statTime">0ms</div>
                                <div class="stat-label">Time</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column -->
            <div class="col-lg-3">
                <!-- System Status -->
                <div class="card p-3">
                    <h5><i class="fas fa-heartbeat me-2"></i>System Status</h5>
                    <div class="mt-3">
                        <div class="d-flex justify-content-between mb-2">
                            <span>Success Rate:</span>
                            <span id="statSuccess">0%</span>
                        </div>
                        <div class="progress mb-3" style="height: 10px;">
                            <div id="successBar" class="progress-bar bg-success" style="width: 0%"></div>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span>Total Paths:</span>
                            <span id="totalPaths">0</span>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span>Failures:</span>
                            <span id="totalFailures">0</span>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span>Current Algorithm:</span>
                            <span id="currentAlgo" class="badge bg-info">A*</span>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span>Last Update:</span>
                            <span id="lastUpdated">--:--:--</span>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="card p-3">
                    <h5><i class="fas fa-bolt me-2"></i>Quick Actions</h5>
                    <div class="mt-3">
                        <button class="btn btn-outline-light w-100 mb-2" onclick="changeAlgorithm('a_star')">
                            Set A* Algorithm
                        </button>
                        <button class="btn btn-outline-light w-100 mb-2" onclick="changeAlgorithm('bfs')">
                            Set BFS Algorithm
                        </button>
                        <button class="btn btn-outline-light w-100 mb-2" onclick="changeAlgorithm('greedy')">
                            Set Greedy Algorithm
                        </button>
                        <button class="btn btn-outline-light w-100" onclick="refreshPath()">
                            <i class="fas fa-sync-alt me-1"></i> Refresh Path
                        </button>
                    </div>
                </div>

                <!-- Algorithm Info -->
                <div class="card p-3">
                    <h5><i class="fas fa-info-circle me-2"></i>Current Algorithm</h5>
                    <div class="mt-2">
                        <h6 id="currentAlgoName">A* Search</h6>
                        <p id="algoDescription" class="small text-muted">
                            Optimal pathfinding with heuristics. Combines Dijkstra's algorithm with heuristic estimates.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
    <script>
        // Load algorithms
        async function loadAlgorithms() {
            const response = await fetch('/api/algorithms');
            const algorithms = await response.json();

            const container = document.getElementById('algorithmList');
            container.innerHTML = '';

            for (const [key, name] of Object.entries(algorithms)) {
                const card = document.createElement('div');
                card.className = 'algorithm-card card p-2 mb-2';
                card.innerHTML = `
                    <div class="d-flex justify-content-between">
                        <div>${name}</div>
                        <i class="fas fa-check d-none"></i>
                    </div>
                `;
                card.onclick = () => selectAlgorithm(key);
                container.appendChild(card);
            }
        }

        async function selectAlgorithm(algo) {
            const response = await fetch('/api/set_algorithm', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({algorithm: algo})
            });

            if (response.ok) {
                loadStats();
                loadPathData();
                loadAlgorithms();
                alert(`Algorithm changed to ${algo}`);
            }
        }

        function changeAlgorithm(algo) {
            selectAlgorithm(algo);
        }

        // System control functions
        async function startSystem() {
            const response = await fetch('/api/start', {method: 'POST'});
            const result = await response.json();
            alert(result.message);
            loadStats();
            loadPathData();
        }

        async function stopSystem() {
            const response = await fetch('/api/stop', {method: 'POST'});
            const result = await response.json();
            alert(result.message);
            loadStats();
        }

        async function autoPoints() {
            const response = await fetch('/api/auto_points', {method: 'POST'});
            const result = await response.json();
            alert(result.success ? 'Points generated!' : 'Failed to generate points');
            loadPathData();
        }

        async function resetMetrics() {
            const response = await fetch('/api/reset_metrics', {method: 'POST'});
            const result = await response.json();
            alert(result.message);
            loadStats();
        }

        // Update grid size
        async function updateGrid(size) {
            document.getElementById('gridValue').textContent = size;

            const response = await fetch('/api/set_grid_size', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({size: parseInt(size)})
            });

            if (response.ok) {
                loadStats();
                loadPathData();
            }
        }

        // Load path data and create visualization
        async function loadPathData() {
            try {
                const response = await fetch('/api/current_path');
                const pathData = await response.json();

                // Update path details
                document.getElementById('pathSteps').textContent = pathData.path ? pathData.path.length : 0;
                document.getElementById('gridSizeDisplay').textContent = `${pathData.grid_size}x${pathData.grid_size}`;

                if (pathData.start) {
                    document.getElementById('startPointDisplay').textContent = `(${pathData.start[0]}, ${pathData.start[1]})`;
                }

                if (pathData.end) {
                    document.getElementById('endPointDisplay').textContent = `(${pathData.end[0]}, ${pathData.end[1]})`;
                }

                if (pathData.has_path && pathData.path && pathData.path.length > 0) {
                    document.getElementById('pathStatus').textContent = 'Path Found';
                    document.getElementById('pathStatus').className = 'badge bg-success';
                } else {
                    document.getElementById('pathStatus').textContent = 'No Path';
                    document.getElementById('pathStatus').className = 'badge bg-danger';
                }

                // Display path coordinates
                const pathContainer = document.getElementById('pathCoordinates');
                if (pathData.path && pathData.path.length > 0) {
                    let pathHtml = '';
                    pathData.path.forEach((point, index) => {
                        pathHtml += `
                            <div class="path-step">
                                <span class="badge bg-dark me-2">${index}</span>
                                (${point[0]}, ${point[1]})
                                ${index === 0 ? '<span class="badge bg-success ms-2">Start</span>' : ''}
                                ${index === pathData.path.length - 1 ? '<span class="badge bg-danger ms-2">End</span>' : ''}
                            </div>
                        `;
                    });
                    pathContainer.innerHTML = pathHtml;
                } else {
                    pathContainer.innerHTML = '<p class="text-muted">No path coordinates available</p>';
                }

                // Create grid visualization
                if (pathData.grid_map && pathData.grid_size) {
                    createGridVisualization(pathData.grid_map, pathData.path, pathData.start, pathData.end);
                }

            } catch (error) {
                console.error('Error loading path data:', error);
            }
        }

        // Create grid visualization
        function createGridVisualization(grid, path, start, end) {
            const container = document.getElementById('pathGridContainer');
            const gridSize = grid.length;

            // Create path map for quick lookup
            const pathMap = new Set();
            if (path) {
                path.forEach(point => {
                    pathMap.add(`${point[0]},${point[1]}`);
                });
            }

            // Create grid HTML
            let gridHtml = `<div class="path-grid" style="grid-template-columns: repeat(${gridSize}, 20px);">`;

            for (let i = 0; i < gridSize; i++) {
                for (let j = 0; j < gridSize; j++) {
                    let cellClass = 'cell-empty';
                    let cellText = '';

                    // Check cell type
                    if (start && i === start[0] && j === start[1]) {
                        cellClass = 'cell-start';
                        cellText = 'S';
                    } else if (end && i === end[0] && j === end[1]) {
                        cellClass = 'cell-end';
                        cellText = 'E';
                    } else if (pathMap.has(`${i},${j}`)) {
                        cellClass = 'cell-path';
                        // Find index in path
                        if (path) {
                            const index = path.findIndex(p => p[0] === i && p[1] === j);
                            if (index !== -1 && index > 0 && index < path.length - 1) {
                                cellText = index;
                            }
                        }
                    } else if (grid[i][j] === 1) {
                        cellClass = 'cell-obstacle';
                    }

                    gridHtml += `<div class="grid-cell ${cellClass}" title="(${i},${j})">${cellText}</div>`;
                }
            }

            gridHtml += '</div>';
            container.innerHTML = gridHtml;
        }

        // Refresh path visualization
        function refreshPath() {
            loadPathData();
            loadStats();
        }

        // Load stats
        async function loadStats() {
            try {
                const response = await fetch('/api/stats');
                const stats = await response.json();

                // Update all stat elements
                document.getElementById('statFPS').textContent = stats.fps;
                document.getElementById('statPath').textContent = stats.path_length;
                document.getElementById('statNodes').textContent = stats.nodes_explored;
                document.getElementById('statTime').textContent = `${stats.computation_time.toFixed(1)}ms`;
                document.getElementById('statSuccess').textContent = `${stats.success_rate.toFixed(1)}%`;
                document.getElementById('totalPaths').textContent = stats.total_paths;
                document.getElementById('totalFailures').textContent = stats.total_failures;
                document.getElementById('lastUpdated').textContent = stats.last_updated;
                document.getElementById('currentAlgo').textContent = stats.algorithm_name;
                document.getElementById('currentAlgoName').textContent = stats.algorithm_name;

                // Update progress bar
                document.getElementById('successBar').style.width = `${Math.min(stats.success_rate, 100)}%`;

            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // Initialize
        async function init() {
            loadAlgorithms();
            loadStats();
            loadPathData();

            // Refresh stats and path every 2 seconds
            setInterval(loadStats, 2000);
            setInterval(loadPathData, 2000);
        }

        // Start when page loads
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
